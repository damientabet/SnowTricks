{% extends 'base.html.twig' %}

{% block body %}
    <div class="row container-fluid" style="margin-top: 110px">
        <div class="col-2">
            <div class="list-group">
                <a class="list-group-item list-group-item-action active" href="{{ path('trick.index') }}">Les
                    figures</a>
                <a class="list-group-item list-group-item-action" href="{{ path('trick.add') }}">Ajouter les figures</a>
                <a class="list-group-item list-group-item-action" href="{{ path('trickGroup.index') }}">Les
                    groupes de
                    figures</a>
                <a class="list-group-item list-group-item-action" href="{{ path('trickGroup.add') }}">Ajouter les
                    groupes de
                    figures</a>
            </div>
        </div>
        <div class="col-10">
            <div class="row">
                <div class="col-2">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="nav-link" href="{{ path('trick.edit', {'id': trickId}) }}">Informations</a>
                        <a class="nav-link active" href="{{ path('image.add', {'trick': trickId}) }}">Images</a>
                        <a class="nav-link" href="{{ path('video.add', {'trick': trickId}) }}">Vidéos</a>
                    </div>
                </div>
                <div class="col-10">
                    <div class="container text-center">
                        <h4>Ajouter une image</h4>
                        {{ form_start(form_image) }}
                        <div class="text-left">{{ form_widget(form_image.name) }}</div>
                        <div class="row p-3">
                            <div class="col">{{ form_widget(form_image.main_img) }}</div>
                            <div class="col">{{ form_widget(form_image.active) }}</div>
                        </div>
                        {{ form_end(form_image) }}
                    </div>
                    {% if images|length > 0 %}
                    <div id="images">
                        <table class="table table-hover col-md-12 text-center">
                            <thead>
                            <tr>
                                <th></th>
                                <th>Active</th>
                                <th>Main</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for image in images %}
                                <tr class="p-3 {% if image.mainImg %}table-active{% endif %}">
                                    <td><img style="max-height: 200px" class="img-thumbnail"
                                             src="/images/tricks/{{ image.name }}" alt=""/>
                                    </td>
                                    <td class="align-middle">{% if image.active == 1 %}<i style="font-size: 30px;"
                                                                                          class="far fa-check-square text-success"></i>{% else %}
                                            <i style="font-size: 30px;"
                                               class="far fa-times-circle text-danger"></i>{% endif %}</td>
                                    <td class="align-middle">{% if image.mainImg == 1 %}<i style="font-size: 30px;"
                                                                                           class="far fa-check-square text-success"></i>{% else %}
                                            <i style="font-size: 30px;"
                                               class="far fa-times-circle text-danger"></i>{% endif %}</td>
                                    <td class="align-middle">
                                        <button id="imageDelete_{{ image.id }}" class="btn btn-danger"
                                                data-url="{{ path('image.delete', {'id': image.id}) }}">Delete
                                        </button>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
        $(document).ready(function () {
            $(document).on('click', '[id^="imageDelete_"]', function () {
                sweetAlert('confirm', 'Are you sure?', $(this).data('url'))
            });

            $('#image_name').on('change', function() {
                var filename = this.files[0].name;
                $('.custom-file-label').text(filename);
            });

            function sweetAlert(type, message, dataUrl = null) {
                switch (type) {
                    case 'success' :
                        swal({
                            title: message,
                            text: 'C\'est bon !',
                            icon: type,
                            button: false,
                            timer: 1000
                        });
                        break;
                    case 'confirm' :
                        swal({
                            icon: "error",
                            title: message,
                            dangerMode: true,
                            confirm: true,
                            buttons: [
                                'Cancel',
                                'Delete'
                            ]
                        })
                            .then(function (e) {
                                if (e === true) {
                                    $.ajax({
                                        type: 'GET',
                                        url: dataUrl,
                                        success: function (data) {
                                            if (data === 'ok') {
                                                sweetAlert('success', 'Image supprimé !');
                                                $("#images").load(" #images");
                                            } else {
                                                sweetAlert('danger', 'Une erreur est survenue !');
                                            }
                                        }
                                    })
                                }
                            });
                        break;
                }
            }
        });
    </script>
{% endblock %}